DIR="$ADEM_HOME"
USER=`whoami`
i=1

VO=$1
SITE_FILE=$2

if [ "X$VO" == "X" ]; then
  echo "(1)Please input the Virtual Organization name which you belong to,as the first parameter.For osg, vo can be:"
  echo "CDF CMS CompBioGrid DES DOSAR DZero Engage Fermilab fMRI GADU geant4 GLOW GPN GRASE GridChem GridEx GROW i2u2 iVDGL LIGO mariachi MIS  nanoHUB NWICG  Ops  OSG OSGEDU SDSS STAR USATLAS"
  echo "(2)Please input the grid sites file as the second parameter.Just use a space to separate the two parameters.You can use auto-get-sites to create the available grid sites file automatically."
  exit
fi

if [ "$SITE_FILE" == "" ]; then
  {
  echo "Oh,no grid sites file for the application deployment.Please input the grid sites file as the second parameter.Just use a space to separate the two parameters.You can use auto-get-sites to create the available grid sites file automatically."
  }
  exit
fi


echo "#sitename	transformation	path	INSTALLED	platform	profiles" > $DIR/tmp/swift-tc.data
j=1
for SITE in $(awk '{print $1}' $SITE_FILE)
do
  echo "#"  >>  $DIR/tmp/swift-tc.data
  echo "#" "[$j]" "$SITE" >> $DIR/tmp/swift-tc.data
  echo "#"  >>  $DIR/tmp/swift-tc.data
  APP=`sed -n "$j"p $SITE_FILE | awk {'print $2'}`
  PACMAN=`sed -n "$j"p $SITE_FILE | awk {'print $3'}`
  
 if [ -f $DIR/tmp/pac-deploy-$SITE-out.log ]; then
 {
  afni=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep afni`
  if [ "$afni" != "" ] ; then
  {
   echo "$SITE	afni	$APP/$VO/$USER/work-pac/afni_src/?	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  angle=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep angle`
  if [ "$angle" != "" ] ; then
  {
   echo "$SITE	angle.sh	$APP/$VO/$USER/work-pac/angle/bin/angle.sh	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  R=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep R`
  if [ "X$R" != "X" ] ; then
  {
   echo "$SITE	R	$APP/$VO/$USER/work-pac/R-2.5.1/bin/R	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  dock=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep dock`
  if [ "$dock" != "" ] ; then
  {
   echo "$SITE	dock6	$APP/$VO/$USER/work-pac/dock6/bin/dock6	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  freesurfer=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep freesurfer`
  if [ "$freesurfer" != "" ] ; then
  {
   echo "$SITE	freesurfer	$APP/$VO/$USER/work-pac/freesurfer/bin/freesurfer	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  gaussian=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep gaussian`
  if [ "$gaussian" != "" ] ; then
  {
   echo "$SITE	g03	$APP/$VO/$USER/work-pac/gaussian/bin/g03	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  blast=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep blast-`
  if [ "X$blast" != "X" ] ; then
  {
   echo "$SITE	blastall	$APP/$VO/$USER/work-pac/blast-2.2.10/bin/blastall	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
   echo "$SITE	formatdb	$APP/$VO/$USER/work-pac/blast-2.2.10/bin/formatdb	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
   }
  fi

  mpiblast=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep mpiblast`
  if [ "$mpiblast" != "" ] ; then
  {
   echo "$SITE	mpiblast	$APP/$VO/$USER/work-pac/mpiblast-1.5.0-pio/bin/mpiblast	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
   }
  fi

  nab=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep nab`
  if [ "$nab" != "" ] ; then
  {
  echo "$SITE	nab	$APP/$VO/$USER/work-pac/nab-5.1.2/bin/nab	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi

  octave=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep octave`
  if [ "$octave" != "" ] ; then
  {
   echo "$SITE	octave	$APP/$VO/$USER/work-pac/octave-3.0.1/bin/octave	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
   }
  fi

  oops=`/bin/cat $DIR/tmp/pac-deploy-$SITE-out.log |grep \* |grep OOPS`
  if [ "$oops" != "" ] ; then
  {
   echo "$SITE	oops	$APP/$VO/$USER/work-pac/clOOPS-0.9.6-BETA1-src/bin/oops	INSTALLED	INTEL32::LINUX	null" >> $DIR/tmp/swift-tc.data
  }
  fi
 }
fi
  j=`expr $j + 1`
done
echo "The tc.data file is $DIR/tmp/swift-tc.data"
